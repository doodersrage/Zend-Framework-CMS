<?phpheader('Content-Type: text/html; charset=UTF-8');include_once('cc_class.php');$ccContactOBJ = new CC_Contact();$ccListOBJ = new CC_List(); // Try to do gather data before we post it	try {	// If state and state name are both collected, we need to remove one before submission	if(isset($_POST["state"]) && isset($_POST["state_name"]))		{			if($_POST["state"] != "" && $_POST["state_name"] != "")			{				$_POST['state_name'] = "";								echo "<h1><center>State Other was erased to prevent errors on submission</center></h1>";			}		}	// if the post is not empty then we will post	if (!empty($_POST['email_address'])) {		$postFields = array();		$postFields["status"] = $_POST["status"];		$postFields["email_address"] = $_POST["email_address"];		$postFields["first_name"] = $_POST["first_name"];		$postFields["last_name"] = $_POST["last_name"];		$postFields["middle_name"] = $_POST["middle_name"];		$postFields["company_name"] = $_POST["company_name"];		$postFields["job_title"]= $_POST["job_title"];		$postFields["home_number"] = $_POST["home_num"];		$postFields["work_number"] = $_POST["wrk_num"];		$postFields["address_line_1"] = $_POST["adr_1"];		$postFields["address_line_2"] = $_POST["adr_2"];		$postFields["address_line_3"] = $_POST["adr_3"];		$postFields["city_name"] = $_POST["city"];		$postFields["state_code"] = $_POST["state"];// The Code is looking for a State Code For Example TX instead of Texas		$postFields["state_name"] = $_POST["state_name"];		$postFields["country_code"] = $_POST["country"];		$postFields["zip_code"] = $_POST["postal_code"];		$postFields["sub_zip_code"] = $_POST["sub_postal"];		$postFields["notes"] = $_POST["notes"];		if(isset($_POST["mail_type"]))		{		$postFields["mail_type"] = $_POST["mail_type"];		}		else		{			$postFields["mail_type"] = "HTML";		}				if(isset($_POST["lists"]))		{		$postFields["lists"] = $_POST["lists"];		}		else		{			$highlight_lists = true;			// If you didnt supply a list you cant have the contact in the acount			throw new Exception("You are missing your list");		}		$postFields["custom_fields"] = array();		foreach($_POST as $key=>$val) {						if (strncmp($key, 'custom_field_', strlen('custom_field_')) === 0) {				$postFields["custom_fields"][substr($key, strlen('custom_field_'), strlen($key)-1)] = $val;			}		}						$contactXML = $ccContactOBJ->createContactXML($_POST['id'],$postFields);				if (!$ccContactOBJ->editSubscriber($_POST['id'],$contactXML)) {			$error = true;		} else {			if(isset($_POST['remove_lists']))			{										if ($_POST['remove_lists']==1) {				$ccContactOBJ->deleteSubscriber($postFields["email_address"]);			}			$error = false;			}		}	}} catch (Exception $e) {		echo "<span style='color:red;'>" . $e . "</span>";	}	$contact = $ccContactOBJ->getSubscriberDetails(urlencode(urldecode(trim($_GET['email']))));	//get all available lists for the current CC account.	$allLists = $ccListOBJ->getLists();	$allStates = $ccContactOBJ->getStates();	$allCountries = $ccContactOBJ->getCountries();	?><?php  include_once('header.php'); ?><script type="text/javascript" language="javascript">	function checkLists(obj) {		var style = obj.checked;		var cont = document.getElementById('chk_container');		inputs = cont.getElementsByTagName('input');		for (i=0;i<inputs.length;i++) {			if (inputs[i]!=obj) {				inputs[i].disabled = style;			}		}	} </script><div align="center" style="width: 900px;"><h2>Edit Subscriber - Full form</h2><?php 	//	// Here we add an area where messages  are displayed (error or success messages).	//		if (isset($error)) {				if ($error === true) {			$class = "error";			$message = $ccContactOBJ->lastError;		} else {			$class = "success";			$message = "Contact edited.";		}		echo '<div class="'.$class.'">';		echo $message;		echo '</div>';	}	?><form action="" method="post"><input type="hidden" name="id" value="<?php  echo $contact['id'] ?>" /><input type="hidden" name="status" value="<?php  echo $contact['status'] ?>" /><div style="float: right; text-align: left; overflow: auto; height: 640px; width:250px;">	<input type="checkbox" class="checkbox"  name="remove_lists" value="1" id="chk_none" onclick="checkLists(this);" <?php  echo ($contact['status']=='Do Not Mail')?' disabled ':'' ?> /><label for="chk_none">UNSUBSCRIBE FROM ALL LISTS</label><br/>	<fieldset id="chk_container">		<legend> Interests list </legend>	<?php	foreach ($allLists as $k=>$item) {		$checked = '';				if (in_array($item['id'],$contact['lists'])) {			$checked = ' checked ';		}		echo '<input type="checkbox" '.$checked.' class="checkbox" name="lists[]" value="'.$item['id'].'" id="chk_'.$k.'" /> <label for="chk_'.$k.'">'.$item['title'].'</label><br/>';	}	?>			</fieldset></div>	<div>	<h3>Contact information</h3>		<table width="580" border="0" cellpadding="2" cellspacing="0">		<tr>			<td align="left">Email Address:</td>			<td align="left"><input type="text" name="email_address" maxLength="100" value="<?php  echo $contact['email_address'] ?>" /></td>			<td align="left">&nbsp;</td>	      	<td align="left">&nbsp;</td>	  </tr>		<tr>			<td align="left">First Name:</td>			<td align="left"><input type="text" name="first_name" maxLength="100" value="<?php  echo $contact['first_name'] ?>" /></td>			<td align="left">Last Name:</td>			<td align="left"><input type="text" name="last_name" maxLength="100" value="<?php  echo $contact['last_name'] ?>"/></td>	    </tr>		<tr>			<td align="left">Middle Name:</td>			<td align="left"><input type="text" name="middle_name" maxLength="100" value="<?php  echo $contact['middle_name'] ?>"/></td>			<td align="left">Home phone:</td>			<td align="left"><input type="text" name="home_num" maxLength="100" value="<?php  echo $contact['home_number'] ?>"/></td>	    </tr>		<tr>			<td align="left" valign="top">Address:</td>			<td align="left" colspan="3">				<input type="text" name="adr_1" maxLength="100" style="width: 440px" value="<?php  echo $contact['address_line_1'] ?>"/><br/>				<input type="text" name="adr_2" maxLength="100" style="width: 440px" value="<?php  echo $contact['address_line_2'] ?>"/><br/>				<input type="text" name="adr_3" maxLength="100" style="width: 440px" value="<?php  echo $contact['address_line_3'] ?>"/><br/>			</td>	    </tr>		<tr>			<td align="left">City:</td>			<td align="left"><input type="text" name="city" maxLength="100" value="<?php  echo $contact['city_name'] ?>"/></td>			<td align="left">State:</td>			<td align="left">				<select name="state">				<option value="">&nbsp;</option>				<?php 	foreach ($allStates as $stateCode=>$stateName) {		$selected = '';				if ($contact['state_code']==$stateCode) {			$selected = ' selected ';		}		echo '<option value="'.$stateCode.'" '.$selected.'>'.$stateName.'</option>';	}	?>				</select>			</td>	    </tr>		<tr>			<td align="left">Zip:</td>			<td align="left"><input type="text" name="postal_code" maxLength="100" value="<?php  echo $contact['zip_code'] ?>"/></td>			<td align="left">State (Other):</td>						<td align="left"><input type="text" name="state_name" maxLength="100" value="<?php  echo empty($contact['state_code'])?$contact['state_name']:'' ?>"/></td>	    </tr>		<tr>			<td align="left">Sub-zip:</td>			<td align="left"><input type="text" name="sub_postal" maxLength="100" value="<?php  echo $contact['sub_zip_code'] ?>"/></td>			<td align="left">Country:</td>			<td align="left">			<select name="country">				<option value="">&nbsp;</option>							<?php 	foreach ($allCountries as $countryCode=>$countryName) {		$selected = '';				if ($contact['country_code']==$countryCode) {			$selected = ' selected ';		}		echo '<option value="'.$countryCode.'" '.$selected.'>'.$countryName.'</option>';	}	?>			</select>			</td>	    </tr>		<tr>			<td align="left">E-Mail Type:</td>			<td align="left" colspan="3">				<input type="radio" class="checkbox" name="mail_type" id="mt1" value="HTML" <?php 	echo ($contact['mail_type']=='HTML')?' checked ':	'';	?> />				<label for="mt1">HTML</label>				&nbsp;or&nbsp;				<input type="radio" class="checkbox" name="mail_type" id="mt2" value="Text" <?php 	echo ($contact['mail_type']=='Text')?' checked ':	'';	?>/>				<label for="mt2">Text</label>			</td>				    </tr>	</table>	<h3>Work details</h3>	<table width="580" border="0" cellpadding="2" cellspacing="0">		<tr>			<td align="left">Company Name:</td>			<td align="left"><input type="text" name="company_name" maxLength="100" value="<?php  echo $contact['company_name'] ?>"/></td>			<td align="left">Job Title:</td>			<td align="left"><input type="text" name="job_title" maxLength="100" value="<?php  echo $contact['job_title'] ?>"/></td>	    </tr>		<tr>			<td align="left">Work phone:</td>			<td align="left"><input type="text" name="wrk_num" maxLength="100" value="<?php  echo $contact['work_number'] ?>"/></td>			<td colspan="2"></td>	    </tr>	</table>	<h3>Custom Fields</h3>	<table width="580" border="0" cellpadding="2" cellspacing="0">		<tr>			<td align="left">Custom Field 1:</td>			<td align="left"><input type="text" name="custom_field_1" maxLength="100" value="<?php  echo $contact['custom_field_1'] ?>"/></td>			<td align="left">Custom Field 2:</td>			<td align="left"><input type="text" name="custom_field_2" maxLength="100" value="<?php  echo $contact['custom_field_2'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 3:</td>			<td align="left"><input type="text" name="custom_field_3" maxLength="100" value="<?php  echo $contact['custom_field_3'] ?>"/></td>			<td align="left">Custom Field 4:</td>			<td align="left"><input type="text" name="custom_field_4" maxLength="100" value="<?php  echo $contact['custom_field_4'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 5:</td>			<td align="left"><input type="text" name="custom_field_5" maxLength="100" value="<?php  echo $contact['custom_field_5'] ?>"/></td>			<td align="left">Custom Field 6:</td>			<td align="left"><input type="text" name="custom_field_6" maxLength="100" value="<?php  echo $contact['custom_field_6'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 7:</td>			<td align="left"><input type="text" name="custom_field_7" maxLength="100" value="<?php  echo $contact['custom_field_7'] ?>"/></td>			<td align="left">Custom Field 8:</td>			<td align="left"><input type="text" name="custom_field_8" maxLength="100" value="<?php  echo $contact['custom_field_8'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 9:</td>			<td align="left"><input type="text" name="custom_field_9" maxLength="100" value="<?php  echo $contact['custom_field_9'] ?>"/></td>			<td align="left">Custom Field 10:</td>			<td align="left"><input type="text" name="custom_field_10" maxLength="100" value="<?php  echo $contact['custom_field_10'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 11:</td>			<td align="left"><input type="text" name="custom_field_11" maxLength="100" value="<?php  echo $contact['custom_field_11'] ?>"/></td>			<td align="left">Custom Field 12:</td>			<td align="left"><input type="text" name="custom_field_12" maxLength="100" value="<?php  echo $contact['custom_field_12'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 13:</td>			<td align="left"><input type="text" name="custom_field_13" maxLength="100" value="<?php  echo $contact['custom_field_13'] ?>"/></td>			<td align="left">Custom Field 14:</td>			<td align="left"><input type="text" name="custom_field_14" maxLength="100" value="<?php  echo $contact['custom_field_14'] ?>"/></td>	    </tr>		<tr>			<td align="left">Custom Field 15:</td>			<td align="left"><input type="text" name="custom_field_15" maxLength="100" value="<?php  echo $contact['custom_field_15'] ?>"/></td>			<td align="left"></td>			<td align="left"></td>	    </tr>		<tr>			<td align="left">Notes:</td>			<td align="left" colspan="3">			<textarea rows="8" cols="50" name="notes"><?php  echo htmlspecialchars($contact['notes']) ?></textarea>			</td>	    </tr>		<tr>			<td align="center" colspan="4">							 			    <input type="submit" name="submit" value="Update this Contact" />		    </td>		</tr>	</table></div></form></div><?php include_once('footer.php'); ?>